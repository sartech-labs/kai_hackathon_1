openapi: 3.0.3
info:
  title: SYNK Multi-Agent Manufacturing Intelligence API
  description: |
    REST + SSE API for the SYNK multi-agent orchestration system.
    5 specialized agents (Production, Finance, Logistics, Procurement, Sales) 
    negotiate in real-time to produce optimal fulfillment plans for manufacturing orders.

    ## Architecture
    ```
    Order -> Orchestrator -> [Production, Finance, Logistics, Procurement, Sales]
                          -> Round 1 (independent analysis)
                          -> Round 2 (cross-agent negotiation)
                          -> Round 3 (final verification)
                          -> Consensus Synthesis
                          -> Customer Callback
    ```

    ## Endpoints Overview
    | Endpoint | Method | Description |
    |----------|--------|-------------|
    | `/api/agents` | GET | List all agents with tools |
    | `/api/agents/{agentId}` | GET | Agent profile + operational params |
    | `/api/agents/{agentId}/analyze` | POST | Run single agent analysis |
    | `/api/orders` | POST | Create and validate an order |
    | `/api/rounds` | POST | Execute one negotiation round (all 5 agents) |
    | `/api/consensus` | POST | Synthesize consensus from rounds |
    | `/api/baseline` | GET | Operational baseline parameters |
    | `/api/orchestrate` | GET | Full orchestration via SSE stream |

    ## Agent Tool Chains
    Each agent exposes domain-specific tools invoked during analysis.
    Tool calls and results are returned as `ActionStep[]` in every proposal,
    giving full observability into each agent's reasoning chain.
  version: 1.0.0
  contact:
    name: SYNK Engineering
  license:
    name: MIT

servers:
  - url: /api
    description: Local / Vercel deployment

tags:
  - name: Agents
    description: Individual agent profiles, tools, and analysis
  - name: Orders
    description: Order creation and validation
  - name: Rounds
    description: Individual negotiation rounds with all agents
  - name: Consensus
    description: Consensus synthesis from completed rounds
  - name: Baseline
    description: Operational baseline parameters
  - name: Orchestration
    description: Full real-time SSE orchestration stream

paths:
  # â”€â”€â”€ Agents â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  /agents:
    get:
      tags: [Agents]
      summary: List all agents
      description: |
        Returns all 5 agents with their profiles, roles, avatar paths,
        available tools (with parameters), and natural-language descriptions.
      operationId: listAgents
      responses:
        "200":
          description: Agent list
          content:
            application/json:
              schema:
                type: object
                properties:
                  agents:
                    type: array
                    items:
                      $ref: "#/components/schemas/AgentProfile"
              example:
                agents:
                  - id: production
                    name: Production
                    role: "Manufacturing & Scheduling"
                    color: "#3b82f6"
                    avatar: /agents/production.jpg
                    description: "Manages factory capacity (4000 units/week), scheduling, and overtime allocation (max 4h/day at $45/hr)."
                    tools:
                      - name: check_production_capacity
                        description: Query factory floor for available capacity and throughput
                        parameters: { quantity: "number", delivery_days: "number" }
                      - name: calculate_overtime
                        description: Compute overtime schedule and cost for production shortfall
                        parameters: { shortfall_days: "number", max_ot_per_day: "number" }
                      - name: recalculate_schedule
                        description: Re-evaluate production schedule with adjusted delivery window
                        parameters: { delivery_days: "number" }
                      - name: lock_production_schedule
                        description: Finalize and lock the production schedule
                        parameters: { delivery_days: "number", overtime_hours: "number" }
                  - id: finance
                    name: Finance
                    role: "Margins & Pricing"
                    color: "#10b981"
                    avatar: /agents/finance.jpg
                    description: "Enforces margin floor (15%), target margin (22%), and negotiates pricing with rush surcharge capability (12%)."
                    tools:
                      - name: compute_unit_economics
                        description: Run margin analysis at a given price point
                        parameters: { price: "number", overtime_hours: "number" }
                      - name: calculate_rush_surcharge
                        description: Calculate rush surcharge to meet margin floor
                        parameters: { base_price: "number", surcharge_rate: "number" }
                      - name: negotiate_price
                        description: Open price negotiation with initial position
                        parameters: { initial_price: "number" }
                      - name: compute_compromise
                        description: Test a compromise price point against margin thresholds
                        parameters: { offer_price: "number" }
                      - name: verify_final_margin
                        description: Final margin verification at locked price
                        parameters: { final_price: "number" }
                  - id: logistics
                    name: Logistics
                    role: "Shipping & Delivery"
                    color: "#f59e0b"
                    avatar: /agents/logistics.jpg
                    description: "Optimizes shipping mode: ground ($0.30/u, 5d), express ($0.85/u, 3d), air ($2.10/u, 1d)."
                    tools:
                      - name: evaluate_shipping_modes
                        description: Compare ground, express, and air freight for delivery window
                        parameters: { delivery_days: "number" }
                      - name: check_route_clearance
                        description: Verify carrier availability and route clearance
                        parameters: { origin: "string", destination: "string", quantity: "number" }
                      - name: re_evaluate_mode
                        description: Re-check shipping mode after delivery adjustment
                        parameters: { delivery_days: "number" }
                      - name: book_carrier
                        description: Book carrier and lock route for final delivery
                        parameters: { mode: "string", delivery_days: "number" }
                  - id: procurement
                    name: Procurement
                    role: "Materials & Suppliers"
                    color: "#8b5cf6"
                    avatar: /agents/procurement.jpg
                    description: "Manages suppliers: primary (ChemCorp Asia, 10d lead) and alternate (EuroChem GmbH, 14d lead)."
                    tools:
                      - name: query_supplier_inventory
                        description: Check supplier for material availability and lead time
                        parameters: { supplier: "string", quantity: "number" }
                      - name: query_alternate_supplier
                        description: Check alternate supplier as backup option
                        parameters: { supplier: "string", quantity: "number" }
                      - name: reserve_materials
                        description: Reserve raw materials with selected supplier
                        parameters: { supplier: "string", quantity: "number" }
                      - name: submit_purchase_order
                        description: Submit final purchase order to supplier
                        parameters: { supplier: "string", quantity: "number", price_per_unit: "number" }
                  - id: sales
                    name: Sales
                    role: "Customer Relations"
                    color: "#ef4444"
                    avatar: /agents/sales.jpg
                    description: "Manages customer relationships. Acme Corp: Strategic tier, 5yr relationship, 120,000 annual volume."
                    tools:
                      - name: lookup_customer_profile
                        description: Retrieve customer tier, relationship history, and annual volume
                        parameters: { customer: "string" }
                      - name: assess_deal_sensitivity
                        description: Evaluate customer sensitivity to price changes
                        parameters: { customer: "string", proposed_price: "number" }
                      - name: calculate_counter_offer
                        description: Compute counter-offer balancing margin and customer retention
                        parameters: { proposed_price: "number", original_price: "number" }
                      - name: calculate_deal_value
                        description: Compute final deal metrics for customer report
                        parameters: { price: "number", quantity: "number" }

  /agents/{agentId}:
    get:
      tags: [Agents]
      summary: Get agent profile
      description: |
        Returns a specific agent's full profile including its operational parameters
        (thresholds, capacity limits, cost structures) that drive its decision-making.
      operationId: getAgent
      parameters:
        - name: agentId
          in: path
          required: true
          schema:
            $ref: "#/components/schemas/AgentId"
      responses:
        "200":
          description: Agent detail
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AgentDetail"
              examples:
                production:
                  summary: Production agent
                  value:
                    id: production
                    name: Production
                    role: "Manufacturing & Scheduling"
                    color: "#3b82f6"
                    avatar: /agents/production.jpg
                    operationalParameters:
                      capacity: 4000
                      standardLeadTime: 22
                      maxOvertimePerDay: 4
                      overtimeCostPerHour: 45
                      workingDaysPerWeek: 5
                finance:
                  summary: Finance agent
                  value:
                    id: finance
                    name: Finance
                    role: "Margins & Pricing"
                    color: "#10b981"
                    avatar: /agents/finance.jpg
                    operationalParameters:
                      baseCostPerUnit: 8.50
                      marginFloor: 0.15
                      targetMargin: 0.22
                      rushSurchargeRate: 0.12
                logistics:
                  summary: Logistics agent
                  value:
                    id: logistics
                    name: Logistics
                    role: "Shipping & Delivery"
                    color: "#f59e0b"
                    avatar: /agents/logistics.jpg
                    operationalParameters:
                      shippingModes:
                        ground: { cost: 0.30, transitDays: 5 }
                        express: { cost: 0.85, transitDays: 3 }
                        air: { cost: 2.10, transitDays: 1 }
                procurement:
                  summary: Procurement agent
                  value:
                    id: procurement
                    name: Procurement
                    role: "Materials & Suppliers"
                    color: "#8b5cf6"
                    avatar: /agents/procurement.jpg
                    operationalParameters:
                      primarySupplier: { name: "ChemCorp Asia", leadTime: 10, costPerUnit: 3.20 }
                      alternateSupplier: { name: "EuroChem GmbH", leadTime: 14, costPerUnit: 3.80 }
                sales:
                  summary: Sales agent
                  value:
                    id: sales
                    name: Sales
                    role: "Customer Relations"
                    color: "#ef4444"
                    avatar: /agents/sales.jpg
                    operationalParameters:
                      customerTier: Strategic
                      relationshipYears: 5
                      annualVolume: 120000
                      acceptableDeliveryBuffer: 2
        "404":
          description: Agent not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

  /agents/{agentId}/analyze:
    post:
      tags: [Agents]
      summary: Run single agent analysis
      description: |
        Invoke one agent's analysis on an order in isolation. Returns the agent's
        full proposal including its tool call chain (`actions`), reasoning, metrics,
        and approval decision.
        
        Use cases:
        - **Testing** individual agent behavior on different order parameters
        - **Debugging** tool chains step by step
        - **Comparing** how agents respond to the same order independently
        
        Pass `previousRound` to simulate round 2 or 3 behavior where the agent
        adjusts based on prior negotiation state.
      operationId: analyzeWithAgent
      parameters:
        - name: agentId
          in: path
          required: true
          schema:
            $ref: "#/components/schemas/AgentId"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [order]
              properties:
                order:
                  $ref: "#/components/schemas/Order"
                round:
                  type: integer
                  minimum: 1
                  maximum: 3
                  default: 1
                  description: Which round to simulate (affects agent behavior)
                previousRound:
                  $ref: "#/components/schemas/RoundSummary"
            examples:
              round1:
                summary: Round 1 -- independent analysis
                value:
                  order:
                    id: ORD-RUSH-001
                    customer: Acme Corp
                    product: PMP-STD-100
                    quantity: 5000
                    requestedPrice: 10.00
                    requestedDeliveryDays: 18
                    priority: rush
                  round: 1
              round2:
                summary: Round 2 -- with previous round context
                value:
                  order:
                    id: ORD-RUSH-001
                    customer: Acme Corp
                    product: PMP-STD-100
                    quantity: 5000
                    requestedPrice: 10.00
                    requestedDeliveryDays: 18
                    priority: rush
                  round: 2
                  previousRound:
                    round: 1
                    price: 11.20
                    deliveryDays: 18
                    margin: 24.1
                    shippingMode: express
                    overtimeHours: 12
                    converged: false
                    proposals: []
      responses:
        "200":
          description: Agent proposal with full tool call trace
          content:
            application/json:
              schema:
                type: object
                properties:
                  agentId:
                    $ref: "#/components/schemas/AgentId"
                  round:
                    type: integer
                  proposal:
                    $ref: "#/components/schemas/AgentProposal"
              example:
                agentId: finance
                round: 1
                proposal:
                  agentId: finance
                  round: 1
                  status: objecting
                  reasoning: "MARGIN ALERT: 12.4% below 15% floor. Requesting 12% surcharge."
                  metrics:
                    Price: "$10.00"
                    Cost: "$9.58"
                    Margin: "12.4%"
                    Status: "BELOW FLOOR"
                  approved: false
                  actions:
                    - kind: tool_call
                      label: "compute_unit_economics(price=$10.00)"
                      detail: "Running margin analysis. Base cost: $8.50/unit. Overtime allocation: $1.08/unit."
                      data: { "Base Cost": "$8.50", "OT Alloc": "$1.08", "Total Cost": "$9.58" }
                    - kind: tool_result
                      label: margin_analysis
                      detail: "Margin at $10.00/unit: 12.4%. Floor: 15%. BELOW FLOOR."
                      data: { "Margin": "12.4%", "Floor": "15%", "Status": "VIOLATION" }
                    - kind: tool_call
                      label: "calculate_rush_surcharge(rate=12%)"
                      detail: "Margin below floor. Calculating 12% rush surcharge."
                    - kind: tool_result
                      label: surcharge_proposal
                      detail: "Proposed price: $11.20/unit. New margin: 23.1%."
                      data: { "Proposed": "$11.20", "New Margin": "23.1%" }
                    - kind: objection
                      label: margin_floor_violation
                      detail: "OBJECTION: Margin 12.4% below 15% floor. Rush surcharge of 12% required."
        "400":
          description: Invalid agent or missing order
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

  # â”€â”€â”€ Orders â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  /orders:
    post:
      tags: [Orders]
      summary: Create and validate an order
      description: |
        Validates order parameters and returns a normalized Order object with a generated ID.
        This endpoint does not trigger orchestration -- use the returned order with
        `/rounds`, `/agents/{id}/analyze`, or `/orchestrate`.
      operationId: createOrder
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/OrderInput"
            example:
              customer: Acme Corp
              product: PMP-STD-100
              quantity: 5000
              requestedPrice: 10.00
              requestedDeliveryDays: 18
              priority: rush
      responses:
        "200":
          description: Validated order
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  order:
                    $ref: "#/components/schemas/Order"
              example:
                success: true
                order:
                  id: ORD-RUSH-001
                  customer: Acme Corp
                  product: PMP-STD-100
                  quantity: 5000
                  requestedPrice: 10.00
                  requestedDeliveryDays: 18
                  priority: rush

  # â”€â”€â”€ Rounds â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  /rounds:
    post:
      tags: [Rounds]
      summary: Execute a negotiation round
      description: |
        Runs a complete negotiation round where ALL 5 agents analyze the order simultaneously.
        Returns each agent's proposal (with full tool call chains), the round summary with
        aggregated metrics, and whether the round converged.
        
        **Chain 3 rounds to reproduce the full negotiation:**
        1. **Round 1** -- Independent analysis. Agents identify constraints (capacity, margin, shipping, suppliers, customer).
        2. **Round 2** -- Cross-agent negotiation. Finance and Sales negotiate price. Production adjusts for new timeline.
        3. **Round 3** -- Final verification. All agents confirm or raise final objections.
        
        Pass the previous round's summary as `previousRound` to give agents negotiation context.
      operationId: executeRound
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [order, round]
              properties:
                order:
                  $ref: "#/components/schemas/Order"
                round:
                  type: integer
                  minimum: 1
                  maximum: 3
                previousRound:
                  $ref: "#/components/schemas/RoundSummary"
            examples:
              round1:
                summary: Round 1 -- initial analysis
                value:
                  order:
                    id: ORD-RUSH-001
                    customer: Acme Corp
                    product: PMP-STD-100
                    quantity: 5000
                    requestedPrice: 10.00
                    requestedDeliveryDays: 18
                    priority: rush
                  round: 1
              round2:
                summary: Round 2 -- with previous round
                value:
                  order:
                    id: ORD-RUSH-001
                    customer: Acme Corp
                    product: PMP-STD-100
                    quantity: 5000
                    requestedPrice: 10.00
                    requestedDeliveryDays: 18
                    priority: rush
                  round: 2
                  previousRound:
                    round: 1
                    price: 11.20
                    deliveryDays: 18
                    margin: 24.1
                    shippingMode: express
                    overtimeHours: 12
                    converged: false
                    proposals: []
      responses:
        "200":
          description: Round results with all agent proposals
          content:
            application/json:
              schema:
                type: object
                properties:
                  round:
                    type: integer
                  converged:
                    type: boolean
                  summary:
                    $ref: "#/components/schemas/RoundSummary"
                  agentProposals:
                    type: array
                    items:
                      type: object
                      properties:
                        agentId:
                          $ref: "#/components/schemas/AgentId"
                        status:
                          $ref: "#/components/schemas/AgentStatus"
                        approved:
                          type: boolean
                        reasoning:
                          type: string
                        metrics:
                          type: object
                          additionalProperties:
                            oneOf: [{ type: string }, { type: number }]
                        actions:
                          type: array
                          items:
                            $ref: "#/components/schemas/ActionStep"
              example:
                round: 2
                converged: false
                summary:
                  round: 2
                  price: 10.80
                  deliveryDays: 19
                  margin: 20.6
                  shippingMode: ground
                  overtimeHours: 8
                  converged: false
                agentProposals:
                  - agentId: production
                    status: proposing
                    approved: true
                    reasoning: "Recalculated with 19-day delivery. OT reduced to 8h."
                    metrics: { "Delivery": "19d", "Overtime": "8h", "Status": "Adjusted" }
                    actions:
                      - kind: tool_call
                        label: "recalculate_schedule(delivery_days=19)"
                        detail: "Re-evaluating production with adjusted 19-day delivery window."
                      - kind: tool_result
                        label: adjusted_schedule
                        detail: "Production days now: 14. Overtime reduced from 12h to 8h."
                        data: { "New Window": "14d", "Overtime": "8h" }
                      - kind: response
                        label: schedule_adjusted
                        detail: "Schedule feasible with adjusted timeline."
                  - agentId: finance
                    status: proposing
                    approved: true
                    reasoning: "Negotiated from $11.20 to $10.80/unit. Margin: 17.2%."
                    metrics: { "Proposed": "$10.80", "Margin": "17.2%", "Surcharge": "Partial" }
                    actions:
                      - kind: tool_call
                        label: "negotiate_price(initial=$11.20)"
                        detail: "Opening negotiation with Sales."
                      - kind: thinking
                        label: evaluating_counter_offer
                        detail: "Sales counter: $10.00. Evaluating split-the-difference."
                      - kind: tool_call
                        label: "compute_compromise(offer=$10.80)"
                        detail: "Testing $10.80/unit -- midpoint plus $0.30 buffer."
                        data: { "Compromise": "$10.80", "Margin": "17.2%" }
                      - kind: tool_result
                        label: compromise_analysis
                        detail: "$10.80/unit yields 17.2% margin. Above floor."
                        data: { "New Margin": "17.2%", "vs Floor": "PASS" }
                      - kind: response
                        label: price_negotiated
                        detail: "Accepting compromise at $10.80/unit."
                  - agentId: logistics
                    status: proposing
                    approved: true
                    reasoning: "Ground freight still optimal. No mode change."
                    metrics: { "Mode": "Ground", "Transit": "5d" }
                    actions:
                      - kind: tool_call
                        label: "re_evaluate_mode(delivery=19d)"
                        detail: "Re-checking shipping mode for 19-day delivery."
                      - kind: tool_result
                        label: "mode_unchanged: ground"
                        detail: "Ground freight still optimal. Transit: 5d."
                        data: { "Mode": "GROUND", "Transit": "5d" }
                      - kind: agreement
                        label: logistics_confirmed
                        detail: "19-day delivery confirmed with ground freight."
                  - agentId: procurement
                    status: proposing
                    approved: true
                    reasoning: "Materials reserved with ChemCorp Asia."
                    metrics: { "Supplier": "ChemCorp Asia", "Status": "RESERVED" }
                    actions:
                      - kind: tool_call
                        label: "reserve_materials(supplier='ChemCorp Asia')"
                        detail: "Reserving 5000 units of raw materials."
                      - kind: tool_result
                        label: materials_reserved
                        detail: "Materials reserved. 5000 units locked at $3.20/unit."
                        data: { "Reserved": 5000, "Total": "$16,000", "Status": "RESERVED" }
                  - agentId: sales
                    status: proposing
                    approved: true
                    reasoning: "$10.80 acceptable for strategic account."
                    metrics: { "Price": "$10.80", "Satisfaction": "HIGH" }
                    actions:
                      - kind: tool_call
                        label: "assess_deal_sensitivity(customer='Acme Corp')"
                        detail: "Evaluating Acme Corp sensitivity to $10.80."
                      - kind: tool_result
                        label: sensitivity_acceptable
                        detail: "8% premium acceptable for strategic account."
                        data: { "Premium": "8%", "Risk": "Low" }
        "400":
          description: Invalid parameters
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

  # â”€â”€â”€ Consensus â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  /consensus:
    post:
      tags: [Consensus]
      summary: Synthesize consensus from rounds
      description: |
        Takes completed negotiation rounds and synthesizes a final consensus decision.
        Returns approval status, final terms, risk assessment, confidence score,
        and per-agent approval breakdown.
      operationId: synthesizeConsensus
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [order, rounds]
              properties:
                order:
                  $ref: "#/components/schemas/Order"
                rounds:
                  type: array
                  items:
                    $ref: "#/components/schemas/RoundSummary"
      responses:
        "200":
          description: Consensus result with metadata
          content:
            application/json:
              schema:
                type: object
                properties:
                  consensus:
                    $ref: "#/components/schemas/ConsensusResult"
                  metadata:
                    type: object
                    properties:
                      totalRounds:
                        type: integer
                      finalRound:
                        type: integer
                      allConverged:
                        type: boolean
                      agentApprovals:
                        type: array
                        items:
                          type: object
                          properties:
                            agentId:
                              $ref: "#/components/schemas/AgentId"
                            approved:
                              type: boolean
                            status:
                              $ref: "#/components/schemas/AgentStatus"
              example:
                consensus:
                  approved: true
                  finalPrice: 10.80
                  finalDeliveryDays: 19
                  finalMargin: 20.6
                  shippingMode: ground
                  riskScore: Low
                  confidence: 94
                  supplier: "ChemCorp Asia"
                  overtimeHours: 8
                  summary: "Order ORD-RUSH-001 APPROVED. 5000 units at $10.80/unit, 19-day delivery via ground. Margin: 20.6%. All agents reached consensus in 3 rounds."
                metadata:
                  totalRounds: 3
                  finalRound: 3
                  allConverged: true
                  agentApprovals:
                    - { agentId: production, approved: true, status: agreed }
                    - { agentId: finance, approved: true, status: agreed }
                    - { agentId: logistics, approved: true, status: agreed }
                    - { agentId: procurement, approved: true, status: agreed }
                    - { agentId: sales, approved: true, status: agreed }
        "400":
          description: Missing parameters
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

  # â”€â”€â”€ Baseline â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  /baseline:
    get:
      tags: [Baseline]
      summary: Get operational baseline
      description: |
        Returns the full set of operational parameters that govern all agent decisions:
        production capacity, cost structures, shipping rates, supplier data, and customer profile.
        These are the "rules of the game" that each agent uses for its analysis.
      operationId: getBaseline
      responses:
        "200":
          description: Baseline parameters
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/BaselineData"
              example:
                production:
                  capacityPerWeek: 4000
                  standardLeadTimeDays: 22
                  overtimeCostPerHour: 45
                  maxOvertimeHoursPerDay: 4
                  workingDaysPerWeek: 5
                finance:
                  baseCostPerUnit: 8.50
                  marginFloor: 0.15
                  targetMargin: 0.22
                  rushSurchargeRate: 0.12
                logistics:
                  shippingModes:
                    ground: { costPerUnit: 0.30, transitDays: 5 }
                    express: { costPerUnit: 0.85, transitDays: 3 }
                    air: { costPerUnit: 2.10, transitDays: 1 }
                procurement:
                  primary: { supplier: "ChemCorp Asia", leadTimeDays: 10, costPerUnit: 3.20 }
                  alternate: { supplier: "EuroChem GmbH", leadTimeDays: 14, costPerUnit: 3.80 }
                sales:
                  customerTier: Strategic
                  relationshipYears: 5
                  annualVolume: 120000
                  acceptableDeliveryBuffer: 2

  # â”€â”€â”€ Orchestration (SSE) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  /orchestrate:
    get:
      tags: [Orchestration]
      summary: Full orchestration (SSE stream)
      description: |
        Streams the entire multi-agent negotiation lifecycle as Server-Sent Events.
        This powers the real-time demo UI.
        
        **Event sequence:**
        1. `phase_change` (order-broadcast)
        2. For each round 1-3:
           - `phase_change` (round-N)
           - `agent_message` events (5-8 inter-agent messages per round)
           - `agent_update` events (5 proposals, one per agent)
           - `round_complete` (round summary)
        3. `phase_change` (consensus) + `consensus_reached`
        4. `phase_change` (callback) + `callback_start` + `callback_message` events
        5. `phase_change` (done) + `done`
        
        **Total events per stream:** ~70-80 events over ~45 seconds
      operationId: orchestrateStream
      parameters:
        - name: order
          in: query
          required: true
          description: URL-encoded JSON string of the Order object
          schema:
            type: string
          example: '%7B%22id%22%3A%22ORD-RUSH-001%22%2C%22customer%22%3A%22Acme%20Corp%22%2C%22product%22%3A%22PMP-STD-100%22%2C%22quantity%22%3A5000%2C%22requestedPrice%22%3A10%2C%22requestedDeliveryDays%22%3A18%2C%22priority%22%3A%22rush%22%7D'
      responses:
        "200":
          description: SSE event stream
          content:
            text/event-stream:
              schema:
                type: string
                description: |
                  Newline-delimited JSON events. Each line: `data: {SSEEvent}\n\n`
              examples:
                phase_change:
                  summary: Phase transition
                  value: 'data: {"type":"phase_change","data":{"phase":"round-1"}}'
                agent_message:
                  summary: Inter-agent negotiation message
                  value: 'data: {"type":"agent_message","data":{"agentMessage":{"id":"msg-3","from":"finance","to":"orchestrator","round":1,"type":"objection","message":"MARGIN ALERT: 12.4% below 15% floor. Requesting 12% surcharge.","timestamp":1709000000}}}'
                agent_update:
                  summary: Agent proposal with tool chain
                  value: 'data: {"type":"agent_update","data":{"agentId":"production","proposal":{"agentId":"production","round":1,"status":"proposing","reasoning":"Capacity check: need 7 days, 13 available. 12h overtime required.","metrics":{"Days Needed":7,"Available":13,"Overtime":"12h"},"approved":true,"actions":[{"kind":"tool_call","label":"check_production_capacity()","detail":"Querying factory floor. Throughput: 4000 units/week.","data":{"Capacity":"4000/wk","Work Days":5}},{"kind":"tool_result","label":"capacity_analysis","detail":"5000 units require 7 production days. Available: 13 days.","data":{"Days Needed":7,"Days Available":13}}]}}}'
                round_complete:
                  summary: Round summary
                  value: 'data: {"type":"round_complete","data":{"roundSummary":{"round":1,"price":11.2,"deliveryDays":18,"margin":24.1,"shippingMode":"express","overtimeHours":12,"converged":false,"proposals":[]}}}'
                consensus_reached:
                  summary: Final consensus
                  value: 'data: {"type":"consensus_reached","data":{"consensus":{"approved":true,"finalPrice":10.8,"finalDeliveryDays":19,"finalMargin":20.6,"shippingMode":"ground","riskScore":"Low","confidence":94,"supplier":"ChemCorp Asia","overtimeHours":8,"summary":"Order ORD-RUSH-001 APPROVED."}}}'
                callback_message:
                  summary: Customer callback
                  value: 'data: {"type":"callback_message","data":{"message":"We can deliver 5,000 units at $10.80 per unit within 19 days."}}'
        "400":
          description: Missing order query parameter

# â”€â”€â”€ Schemas â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
components:
  schemas:
    AgentId:
      type: string
      enum: [production, finance, logistics, procurement, sales]

    AgentStatus:
      type: string
      enum: [idle, analyzing, proposing, objecting, agreed]

    ActionStepKind:
      type: string
      enum: [tool_call, tool_result, thinking, response, objection, agreement]

    ShippingMode:
      type: string
      enum: [ground, express, air]

    DemoPhase:
      type: string
      enum: [idle, incoming-call, active-call, order-broadcast, round-1, round-2, round-3, consensus, callback, done]

    OrderInput:
      type: object
      description: Input payload to create a new order
      properties:
        customer:
          type: string
          example: Acme Corp
        product:
          type: string
          example: PMP-STD-100
        quantity:
          type: integer
          example: 5000
        requestedPrice:
          type: number
          format: double
          example: 10.00
        requestedDeliveryDays:
          type: integer
          example: 18
        priority:
          type: string
          enum: [standard, rush, critical]
          example: rush

    Order:
      type: object
      required: [id, customer, product, quantity, requestedPrice, requestedDeliveryDays, priority]
      properties:
        id:
          type: string
          example: ORD-RUSH-001
        customer:
          type: string
          example: Acme Corp
        product:
          type: string
          example: PMP-STD-100
        quantity:
          type: integer
          example: 5000
        requestedPrice:
          type: number
          format: double
          example: 10.00
        requestedDeliveryDays:
          type: integer
          example: 18
        priority:
          type: string
          enum: [standard, rush, critical]
          example: rush

    ActionStep:
      type: object
      required: [kind, label, detail]
      properties:
        kind:
          $ref: "#/components/schemas/ActionStepKind"
        label:
          type: string
          description: Tool function name or step label
          example: "check_production_capacity()"
        detail:
          type: string
          description: Human-readable description of what happened
          example: "Querying factory floor for available capacity."
        data:
          type: object
          additionalProperties:
            oneOf: [{ type: string }, { type: number }]
          description: Structured key-value data from tool execution
          example: { "Capacity": "4000/wk", "Work Days": 5 }

    AgentProposal:
      type: object
      required: [agentId, round, status, reasoning, metrics, approved, actions]
      properties:
        agentId:
          $ref: "#/components/schemas/AgentId"
        round:
          type: integer
          minimum: 1
          maximum: 3
        status:
          $ref: "#/components/schemas/AgentStatus"
        reasoning:
          type: string
        metrics:
          type: object
          additionalProperties:
            oneOf: [{ type: string }, { type: number }]
        approved:
          type: boolean
        actions:
          type: array
          items:
            $ref: "#/components/schemas/ActionStep"
          description: Full tool call chain -- the agent's step-by-step reasoning trace

    AgentMessage:
      type: object
      required: [id, from, to, round, type, message, timestamp]
      properties:
        id:
          type: string
        from:
          type: string
          description: Sender (agentId or "orchestrator")
        to:
          type: string
          description: Recipient (agentId or "all")
        round:
          type: integer
        type:
          type: string
          enum: [proposal, objection, counter, agreement, info, directive]
        message:
          type: string
        timestamp:
          type: integer
          format: int64

    RoundSummary:
      type: object
      required: [round, price, deliveryDays, margin, shippingMode, overtimeHours, proposals, converged]
      properties:
        round:
          type: integer
        price:
          type: number
          format: double
        deliveryDays:
          type: integer
        margin:
          type: number
          format: double
          description: Margin as percentage (e.g. 20.6 = 20.6%)
        shippingMode:
          $ref: "#/components/schemas/ShippingMode"
        overtimeHours:
          type: number
        proposals:
          type: array
          items:
            $ref: "#/components/schemas/AgentProposal"
        converged:
          type: boolean
          description: True if all agents approved

    ConsensusResult:
      type: object
      required: [approved, finalPrice, finalDeliveryDays, finalMargin, shippingMode, riskScore, confidence, supplier, overtimeHours, summary]
      properties:
        approved:
          type: boolean
        finalPrice:
          type: number
          format: double
        finalDeliveryDays:
          type: integer
        finalMargin:
          type: number
          format: double
        shippingMode:
          $ref: "#/components/schemas/ShippingMode"
        riskScore:
          type: string
          enum: [Low, Medium, High]
        confidence:
          type: integer
          minimum: 0
          maximum: 100
        supplier:
          type: string
        overtimeHours:
          type: number
        summary:
          type: string

    SSEEvent:
      type: object
      required: [type, data]
      properties:
        type:
          type: string
          enum: [phase_change, agent_update, agent_message, round_complete, consensus_reached, callback_start, callback_message, done]
        data:
          type: object
          properties:
            phase:
              $ref: "#/components/schemas/DemoPhase"
            agentId:
              $ref: "#/components/schemas/AgentId"
            proposal:
              $ref: "#/components/schemas/AgentProposal"
            agentMessage:
              $ref: "#/components/schemas/AgentMessage"
            roundSummary:
              $ref: "#/components/schemas/RoundSummary"
            consensus:
              $ref: "#/components/schemas/ConsensusResult"
            message:
              type: string

    AgentProfile:
      type: object
      properties:
        id:
          $ref: "#/components/schemas/AgentId"
        name:
          type: string
        role:
          type: string
        color:
          type: string
        avatar:
          type: string
        description:
          type: string
        tools:
          type: array
          items:
            type: object
            properties:
              name:
                type: string
              description:
                type: string
              parameters:
                type: object
                additionalProperties:
                  type: string

    AgentDetail:
      type: object
      properties:
        id:
          $ref: "#/components/schemas/AgentId"
        name:
          type: string
        role:
          type: string
        color:
          type: string
        avatar:
          type: string
        operationalParameters:
          type: object
          additionalProperties: true

    BaselineData:
      type: object
      properties:
        production:
          type: object
          properties:
            capacityPerWeek: { type: integer }
            standardLeadTimeDays: { type: integer }
            overtimeCostPerHour: { type: number }
            maxOvertimeHoursPerDay: { type: integer }
            workingDaysPerWeek: { type: integer }
        finance:
          type: object
          properties:
            baseCostPerUnit: { type: number }
            marginFloor: { type: number }
            targetMargin: { type: number }
            rushSurchargeRate: { type: number }
        logistics:
          type: object
          properties:
            shippingModes:
              type: object
              additionalProperties:
                type: object
                properties:
                  costPerUnit: { type: number }
                  transitDays: { type: integer }
        procurement:
          type: object
          properties:
            primary:
              type: object
              properties:
                supplier: { type: string }
                leadTimeDays: { type: integer }
                costPerUnit: { type: number }
            alternate:
              type: object
              properties:
                supplier: { type: string }
                leadTimeDays: { type: integer }
                costPerUnit: { type: number }
        sales:
          type: object
          properties:
            customerTier: { type: string }
            relationshipYears: { type: integer }
            annualVolume: { type: integer }
            acceptableDeliveryBuffer: { type: integer }

    Error:
      type: object
      properties:
        error:
          type: string

